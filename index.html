<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2018%2018'%3E%3Ctext%20x='-2'%20y='16'%3EüöÄ%3C/text%3E%3C/svg%3E" type="image/svg+xml" />
    <title>Estudos</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #222;
            color: white;
        }
        .materia {
            margin-bottom: 3em;
        }
        .materia input[type="text"] {
            font-size: 18px;
            margin-bottom: 10px;
            display: block;
            color: white;
            background-color: transparent;
            border: 1px solid #353535;
            padding: 6px;
            width: 20em;
        }
        .aulaWrapper{
        	position: relative;
        	display: inline-block;
        }
        .aula {
            width: 7em;
            height: 7em;
            border-radius: 50%;
            display: inline-block;
            padding-top: 1em;
            margin: 8px;
            text-align: center;
            font-size: 0.8em;
            cursor: pointer;
            border: 3px solid #00000000;
            color: #222;
        	z-index: 2;
        }
        .border{
        	position: absolute;
        	top:0;
        	left:0;
        	width: 7em;
            height: 7em;
            border-radius: 50%;
            display: inline-block;
            padding-top: 1em;
            margin: 8px;
            text-align: center;
            font-size: 0.8em;
            border: 3px solid #00000018;
            color: #222;
        	z-index: -1;
        	transform: scale(1.15);
        	
        }
        .border-alertar{
        	opacity: .2;
        }
        .aula .nome {
            display: block;
            font-size: 1.3em;
            padding: 0 .4em;
            max-width: 100%;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .aula .status {
            display: block;
            font-size: 0.8em;
            margin: 0.5em;
        }
        .alertar {
          /*  border: 3px solid #ff4747; */
            background-size: cover;
            background-origin: border-box;
            color: white;
        }
        .alertar .status, .alertar .nome,.alertar button{
        	font-weight: 600;
        }
        .alertexto:not(:empty){
        	position: absolute;
            left: 0;
            bottom: 0;
            opacity: 0.2;
            border-radius: 15px;
            color:#d9d9d9;
            background-color: #373737;
            padding: 6PX;
        	cursor: default;
            z-index:-1;
        }
        .broken1{
        	/* https://heyallan.github.io/svg-to-data-uri/ */
        	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 67 68'%3E%3Cstyle%3E.s0 %7B fill: %23222222 %7D%3C/style%3E%3Cpath id='broken_path' class='s0' d='m50 68l-16-18-1-11 6-1 2-22 13-9 13-8-23-1-2 8-7 5v24l-15 3-15-12-3-5-5 4 2 7 1-4 5 2 10 10-16 11v12l15 7-5-14 12-15 9-1v13l9 16zm-3-77'/%3E%3C/svg%3E"),
            linear-gradient(
              to bottom,
              rgba(255, 255, 0, 0),
              rgba(17, 0, 255, 0.308)
            ); 
        	
        }
        .broken2{
        	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 67 68'%3E%3Cstyle%3E.s0 %7B fill: %23222222 %7D%3C/style%3E%3Cpath id='broken_path' class='s0' d='m3.3 76.5l14.5-33.8 9.3-6 3.7 4.9 20.4-8.4 14 7.4 17.5 8.1-10.1-22.8-12.1 3.6-7.7-3.9-21.2 11.1-9.6-12 3.7-18.8 3-5 5-9.9-18.7 8.7 6.6 2.7 0.5 5.3-4.2 13.5-17.2-9.1-17.4 8.7 7.5 13.4 10.1-10.9 18.9 3.7 5 7.5-11.5 6.1-19.5 27.4z'/%3E%3C/svg%3E"),
            linear-gradient(
              to bottom,
              rgba(255, 255, 0, 0),
              rgba(17, 0, 255, 0.308)
            ); 
        }
        .broken3{
        	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 67 68'%3E%3Cstyle%3E.s0 %7B fill: %23222222 %7D%3C/style%3E%3Cpath id='broken_path' class='s0' d='m53.8 81.4l-21.1-30-0.2-11.1 6-0.6 3.6-21.8 13.5-8 16.1-10.7-24.7-3.4-3.3 12.2-7.3 4.5-1.7 24-15.1 1.9-14.2-13-2.6-5.2-5.8-9.5-2.4 20.5 5.7-4.2 4.9 2.4 9.2 10.7-16.7 9.8-1.7 19.4 15.3 0.6-4-14.3 13.1-14.1 9-0.4-0.9 13 13.2 31z'/%3E%3C/svg%3E"),
            linear-gradient(
              to bottom,
              rgba(255, 255, 0, 0),
              rgba(17, 0, 255, 0.308)
            ); 
        }
        .broken4{
        	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 67 68'%3E%3Cstyle%3E.s0 %7B fill: %23222222 %7D%3C/style%3E%3Cpath id='broken_path' class='s0' d='m83.5 46.3l-36.7-1.6-8.9-6.6 3.2-5.1-15.1-16.1 1.9-15.7 1.3-19.2-17.7 17.5 7.7 10-0.9 8.6 17.9 15.9-7.7 13.2-18.9 3.3-5.8-1.1-11-1.2 3.5 22.1 11.4-14.8 4.9-2.4 14.1-0.8-2.4 19.2 14.3 13.2 9.8-11.8-13.7-5.5-3.3-19 5.2-7.3 9.8 8.6 32.6 8.5z'/%3E%3C/svg%3E"),
            linear-gradient(
              to bottom,
              rgba(255, 255, 0, 0),
              rgba(17, 0, 255, 0.308)
            ); 
        }
        .broken5{
        	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 67 68'%3E%3Cstyle%3E.s0 %7B fill: %23222222 %7D%3C/style%3E%3Cpath id='broken_path' class='s0' d='m66.1-4.6l-14.3 33.8-9.3 6.1-3.7-4.9-20.3 8.6-14.1-7.3-17.5-8 10.2 22.7 12-3.6 7.7 3.8 21.3-11.2 9.6 11.8-3.6 18.9-3 5-4.9 9.9 21.9 4.5-9.9-15.9-0.5-5.4 4.1-13.5 17.2 9 17.4-8.8-7.6-13.3-10 10.9-18.9-3.6-5.1-7.5 11.5-6 19.4-27.6z'/%3E%3C/svg%3E"),
            linear-gradient(
              to bottom,
              rgba(255, 255, 0, 0),
              rgba(17, 0, 255, 0.308)
            ); 
        }
        .broken6{
        	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 67 68'%3E%3Cstyle%3E.s0 %7B fill: %23222222 %7D%3C/style%3E%3Cpath id='broken_path' class='s0' d='m-4.8-3.3l31.7 18.7 4.7 9.9-5.2 3 5.7 21.4-9 12.9-10.2 16.3 23.8-7.1-2-12.4 4.8-7.1-8.4-22.5 13.1-8.1 18.2 6.1 4.6 3.6 9.2 6.2 7.2-21.2-17 7.8-5.4-0.2-12.8-5.9 11.1-15.9-6.4-18.3-14.2 5.7 9.5 11.4-6 18.3-8.1 4-4.5-12.2-24.8-22.8z'/%3E%3C/svg%3E"),
             linear-gradient(
              to bottom,
              rgba(255, 255, 0, 0),
              rgba(17, 0, 255, 0.308)
            ); 
        }
        .broken7{
        	background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 67 68'%3E%3Cstyle%3E.s0 %7B fill: %23222222 %7D%3C/style%3E%3Cpath id='broken_path' class='s0' d='m-2.1 72.1l23.8-28 10.6-3 2.1 5.7 22-2 11.2 11.1 14.3 12.9-2.9-24.7-12.6-0.2-6.2-5.9-23.6 4.3-5.7-14.2 9.1-16.9 4.4-3.9 7.7-8-19.6-10.8 4.6 18.1-1 5.3-8 11.7-13.8-13.8-19.2 3.2 3.3 15.1 12.8-7.5 17 9.1 2.6 8.6-12.8 2.4-26.7 20.5z'/%3E%3C/svg%3E"),
        	linear-gradient(
              to bottom,
              rgba(255, 255, 0, 0),
              rgba(17, 0, 255, 0.308)
            ); 
        }
        .inicial {
            background-color: #464646;
        	color: white;
        }
        .estudando {
            background-color: #7cb516;
            color: white;
        }
        .border-estudando{
        	border: #7cb516 3px solid;
        }
        .questoes1,
        .questoes2,
        .questoes3 {
            background-color: #ffd91c;
        }
        .border-questoes1{
        	border-right: #ffd91c 3px solid;
        }
        .border-questoes2{
        	border-right: #ffd91c 3px solid;
        	border-bottom: #ffd91c 3px solid;
        
        }
        .border-questoes3{
        	border-right: #ffd91c 3px solid;
        	border-bottom: #ffd91c 3px solid;
        	border-left: #ffd91c 3px solid;
        }
        .revisao {
            background-color: #b826c8;
            color: white;
        }
        .border-revisao{
        	border: #b826c8 3px solid;
        }
        
        .aula button {
            background-color: #ffffff77;
            border: none;
            color: inherit;
            border-radius: 5px;
            cursor: crosshair;
        }
        
        button {
            background-color: #ffffff45;
            color: white;
            border: none;
        }
        .button {
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #ffffff45;
            color: white;
            border: none;
        }

	button.config-aula {	
   	   display: block;
    	   background-color: transparent;
    	   border: none;
	   position: absolute;
   	   top: 0;
   	   right: -8px;
 	   stroke: #2d2d2d;
	   cursor: pointer;
	}
	.aulaWrapper:hover .config-aula{
	    stroke: #e4e4e4;
	}

	    
        .addAula{
            border-radius: 4px;
            padding: 0.5em .7em;
        	position: relative;
            top: -1.5em;
        	margin-left: 2em;
        	background-color: #39393942;
        }
        .addMateria{
            border-radius: 4px;
            padding: 1em 1em;
        	position: relative;
            top: -1.5em;
        	margin-left: 2em;
        	background-color: #76428e42;
        }
        .upBtn{
           
        }
        .upBtn,.downBtn{
            margin-left: 1em;
            padding: .6em;
            background-color: #39393942;
            border-radius: 5px;
        }
        
        	    
        #jsonArea, #log, #reportArea{
            width: 100%;
            height: 200px;
        }
        #log{
           
            color: white;
            background-color: black;
        }
        summary {
        }
        
        input[type="radio"]:after {
            width: 15px;
            height: 15px;
            border-radius: 15px;
            top: -2px;
            left: -1px;
            position: relative;
            background-color: #333;
            content: "";
            display: inline-block;
            visibility: visible;
            border: 2px solid #444;
        }
        
        input[type="radio"]:checked:after {
            width: 15px;
            height: 15px;
            border-radius: 15px;
            top: -2px;
            left: -1px;
            position: relative;
            background-color: #91ef62;
            content: "";
            display: inline-block;
            visibility: visible;
            border: 2px solid #444;
        }
        
        
        progress::-webkit-progress-value {
            background:#7cb516;
        }
        progress::-moz-progress-value {
            background:#7cb516;
        }
        progress::-webkit-progress-bar{
            background: #111;
            padding: 0px;
        }
        progress::-moz-progress-bar {  
            background: #111;
            
            padding: 0px;
        }
        progress {
            display:block;
            -webkit-appearance: none;
            height: 2px;
            width: 100%;
            margin-top: 1em;
        }
        .progressMateriaTexto, #progressoTotalTexto{
          margin-top: 2em;
          color: #444;
        }
	.progressMateriaTexto:hover, #progressoTotalTexto:hover{
          color: #ddd;
        }
	    
        #progressoTotalBarra::-webkit-progress-value {
          background:#b826c8;
        }
        #progressoTotal{
          margin-top: 2em;
          margin-bottom:2em;
        }
        
        .streakDia{
          display: inline-block;
            width: 1.2em;
            height: 1.2em;
            border-radius: 4px;
            margin: .2em;
        }

        .streakDia {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin: 2px;
            position: relative;
        }

        .dayName {
            position: absolute;
            top: -20px;
            width: 100%;
            text-align: center;
            font-size: 12px;
        }
        #streak{
            margin-top:3em;
            margin-bottom:2em;
        }
        #streakDays, #streakInfo{
            color: #ddd;
            text-align: center;
        }
        .dayCount{
            margin-top: 0.6em;
            font-size: 0.8em;
            color: #00000021;
        }



        /* POPOVER */

        .popover {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000;
    width: 300px;
    color: #d9d9d9;
    background-color: #101010;
    border-radius: 8px;
    box-shadow: 0px 0px 50px rgb(0 0 0 / 27%);
    padding: 1em;
    box-sizing: border-box;
}

.popover label {
    display: block;
    margin-top: 1em;
    font-weight: bold;
    margin-bottom: .5em;
}

.popover input[type="text"] {
    width: 100%;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

.popover button {
    display: inline-block;
    padding: 8px 12px;
    margin-top: .2em;
    border: none;
    border-radius: 4px;
    background-color: #4CAF50;
    color: white;
    cursor: pointer;
    font-size: 14px;
    transition: background-color 0.3s ease;
}
.popover button:hover {
    background-color: #45a049;
}
.popover ul {
    list-style: none;
    padding: 0;
    margin-bottom: 0;
}
.popover ul li {
    padding: .3em 2em;
    background-color: #222222;
    border-radius: 4px;
    margin-top: 5px;
}

.popover ul li button{
    background-color: #f44336;
    margin-left: 3em;
}
button:disabled,
button[disabled]{
  border: 1px solid #999999;
  background-color: #cccccc !important;
  color: #666666;
  cursor: no-drop;
}
.popover-delete {
    margin-top: 2em !important;
    background-color: #f4433636 !important;
}
.popover-delete:hover { 
    background-color: #e53935 !important;
}
.popover ul li button:hover{ 
    background-color: #ea4235;
}

.popover-close {
    position: absolute;
    top: 1em;
    right: 1em;
    background-color: #2b2b2b !important;
    color: #aaaaaa !important;
    padding: 5px 8px;
    font-size: 16px;
    line-height: 16px;
    border-radius: 50%;
    cursor: pointer;
}

.popover-close:hover {
    background-color: #bbb;
}


        
    </style>
</head>

<body>
    <div id="streak">
        <div id="streakDays"></div>
        <div id="streakInfo"></div>
    </div>
    <div id="progressoTotal">
        <div id="progressoTotalTexto"></div>
        <progress id="progressoTotalBarra" min="0" max="100"></progress>
    </div>
	<div style="margin:auto"><div id="reviewSection"></div></div>
    <div id="app"></div>
    <button class="button addMateria" onclick="
	    materias.push({ nome: `Mat√©ria ${materias.length + 1}`, aulas: [] });
            render();
            save();">Adicionar Mat√©ria
    </button>
	
    <details>
        <summary>exportar/importar</summary>
        <button class="button" onclick="copyToJson()">exportar</button>
        <button class="button" onclick="loadFromJson()">importar</button>
        <button class="button" onclick="exportToFile()">Download em TXT</button>
        <textarea id="jsonArea" placeholder="JSON"></textarea>
        hist√≥rico
        <textarea id="log" placeholder=" hist√≥rico"></textarea>
	<button class="button" onclick="generateReport()">Gerar Relat√≥rio</button>
        <textarea id="reportArea"></textarea>
	    
    </details>

    <script>
        const materias = JSON.parse(localStorage.getItem('materias')) || [
          {
            "nome": "Mat√©ria 1",
            "aulas": []
          }
        ];
        
        const statusWeights = {
        		    'inicial': 0,
        		    'estudando': 10,
        		    'questoes1': 50,
        		    'questoes2': 75,
        		    'questoes3': 85,
        		    'revisao': 100 
        		};


        function formatDate(date){
          let dateString = date.getFullYear()+'-'+String(date.getMonth()+1).padStart(2, '0')+'-'+String(date.getDate()).padStart(2, '0');
          return dateString;
        }
        
        function render() {
        	const app = document.getElementById('app');
        	app.innerHTML = '';
        	let selectedRadio = localStorage.getItem('selectedRadio');
            let countAulas = 0;
        	materias.forEach((materia, mIndex) => {
        		const materiaDiv = document.createElement('div');
        		materiaDiv.className = 'materia';
        
        		const materiaDivTitle = document.createElement('div');
        		materiaDivTitle.className = 'title';
        		materiaDiv.appendChild(materiaDivTitle);
        
        		
        
        		const radiox = document.createElement('input');
        		radiox.type = 'radio';
        		radiox.id = 'm' + mIndex;
        		radiox.value = mIndex;
        		radiox.name = "onde";
        		radiox.style = "display: inline-block";
        		radiox.checked = (selectedRadio === mIndex);
        
        		materiaDivTitle.appendChild(radiox);
        
        
        		const input = document.createElement('input');
        		input.type = 'text';
        		input.value = materia.nome;
        		input.oninput = (e) => {
        			materia.nome = e.target.value;
        			save();
        		};
        		input.style = "display: inline-block";
        		materiaDivTitle.appendChild(input);
        
        
        
        		const upBtn = document.createElement('button');
        		upBtn.innerHTML = '&#x25B5;'; // Seta para cima
        		upBtn.className = 'upBtn';
        		upBtn.onclick = () => {
        		    if (mIndex > 0) {
         		       [materias[mIndex], materias[mIndex - 1]] = [materias[mIndex - 1], materias[mIndex]];
        		        render();
         		       save();
         		   }
        		};	
        		materiaDivTitle.appendChild(upBtn);
        
        		const downBtn = document.createElement('button');
        		downBtn.innerHTML = '&#x25BF;'; // Seta para baixo
        		downBtn.className = 'downBtn';
        		downBtn.onclick = () => {
          		  if (mIndex < materias.length - 1) {
          		      [materias[mIndex], materias[mIndex + 1]] = [materias[mIndex + 1], materias[mIndex]];
        		        render();
          		      save();
         		   }
        		};
        		materiaDivTitle.appendChild(downBtn);
        
        		
        
        		materia.aulas.forEach((aula, aIndex) => {
        			countAulas++;
        			//console.log(aula);
        			updateStatus(mIndex, aIndex);
        			//console.log(aula);
        
        			const aulaDiv = document.createElement('div');
        
        			const borderDiv = document.createElement('div');
        			borderDiv.classList.add("border");
        			
        
        			let alerta = "";
        			if (aula.alerta) {
        				alerta = !isNaN(aula.daysDiff)?aula.daysDiff:"";
        				aulaDiv.classList.add("alertar");
        				const brokenArray = [1, 2, 3, 4, 5, 6, 7];
        				const broken = brokenArray[countAulas % brokenArray.length];
        				aulaDiv.classList.add("broken"+broken);
        
        				borderDiv.classList.add("border-alertar");
        			} else {
                        alerta = !isNaN(aula.daysDiff)?aula.daysDiff:"";
        				//aulaDiv.classList.remove("alertar");
        			}
        			aulaDiv.classList.add("aula");
        			aulaDiv.classList.add(aula.status);
        
        
        			let textoStatus = "";
        			switch (aula.status) {
        				case "inicial":
        					textoStatus = "&nbsp;";
        					break;
        				case "estudando":
        					textoStatus = "estudando";
        					break;
        				case "questoes1":
        					textoStatus = "quest√µes 1/4";
        					break;
        				case "questoes2":
        					textoStatus = "quest√µes 2/4";
        					break;
        				case "questoes3":
        					textoStatus = "quest√µes 3/4";
        					break;
        				case "revisao":
        					textoStatus = "revisando";
        					break;
        				default:
        
        					break;
        			}
        
        			//aulaDiv.className = `aula ${aula.status}`;
        			aulaDiv.innerHTML = `<span class="nome" title="${aula.nome}">${aula.nome}</span><span class="status">${textoStatus}</span><span class="alertexto">${alerta}</span>`;
        
        			const saveDateBtn = document.createElement('button');
        			saveDateBtn.textContent = '+';
        			saveDateBtn.onclick = (e) => {
        				e.stopPropagation();
        				const today = formatDate(new Date(new Date()-(1000*60*60*5))); // subtraindo 5h para que o estudo at√© 6h da manh√£ seja considerado do dia anterior
        				aula.estudos.push(today);
                                        logAction(`(${aula.nome}) adicionado estudo: ${today} [${materia.nome}]`);
        				//updateStatus(mIndex, aIndex);
        				render();
        				save();
        			};
        			aulaDiv.appendChild(saveDateBtn);
        			if (aula.status == "inicial") {
        				saveDateBtn.style = "visibility: hidden";
        			}
				

				const configAulaBtn = document.createElement('button');
				configAulaBtn.classList.add("config-aula");
				configAulaBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>`;
				aulaDiv.appendChild(configAulaBtn);
				configAulaBtn.onclick = (e) => {
        				e.stopPropagation();
                        //logAction(`(${aula.nome}) Configurando [${materia.nome}]`);
                        openAulaConfigPopover(aula,materia);
        			};

				
        			aulaDiv.onclick = () => {
        				const currentStatus = aula.status;
        				const statuses = ['inicial', 'estudando', 'questoes1', 'questoes2', 'questoes3', 'revisao'];
        				const nextStatus = statuses[(statuses.indexOf(currentStatus) + 1) % statuses.length];
        				aula.status = nextStatus;
        				//updateStatus(mIndex, aIndex);
                        logAction(`(${aula.nome}) para status: ${aula.status} [${materia.nome}]`);
        				render();
        				save();
        			};
        
        			const aulaWrapperDiv = document.createElement('div');
        			aulaWrapperDiv.classList.add("aulaWrapper");
        			materiaDiv.appendChild(aulaWrapperDiv);
        			
        
        			aulaWrapperDiv.appendChild(aulaDiv);
        
        			
        			borderDiv.classList.add("border-"+aula.status);
        			aulaWrapperDiv.appendChild(borderDiv);
        
        		});
        
        		const addAulaBtn = document.createElement('button');
        		addAulaBtn.textContent = 'Adicionar Aula';
        		addAulaBtn.className = "addAula";
        		addAulaBtn.style = "padding: 1em; margin-top:1em";
        		addAulaBtn.onclick = () => {
                    let nomeAula = 0;
                    if(materia.aulas.length > 0){
                       nomeAula = (materia.aulas[materia.aulas.length - 1].nome + 1);
                       if(isNaN(materia.aulas[materia.aulas.length - 1].nome)){
                           nomeAula = materia.aulas.length;
                       }
                    }
				
        			materia.aulas.push({
        				status: 'inicial',
        				estudos: [],
        				nome: nomeAula,
        				alerta: false
        			});
                    
        			render();
        			save();
        		};
        		materiaDiv.appendChild(addAulaBtn);


			// bot√£o para adicionar materia no meio
			        // === IN√çCIO DO C√ìDIGO PARA ADICIONAR ===
        const addMateriaAbaixoBtn = document.createElement('button');
        addMateriaAbaixoBtn.textContent = 'Adicionar Mat√©ria';
        // Reutiliza a classe 'button' para estilo base e adiciona uma espec√≠fica
        addMateriaAbaixoBtn.className = 'button addMateriaAbaixo';
        // Adiciona um pouco de margem para separar do bot√£o anterior
        addMateriaAbaixoBtn.style.marginLeft = '10px';

        addMateriaAbaixoBtn.onclick = () => {
            // Cria um objeto para a nova mat√©ria
            const novaMateria = {
                nome: `Nova Mat√©ria`, // Voc√™ pode querer um nome padr√£o diferente
                aulas: []
            };
            // Insere a nova mat√©ria no array 'materias' na posi√ß√£o logo ap√≥s a atual (mIndex + 1)
            // O segundo argumento '0' significa que n√£o estamos removendo nenhum item.
            materias.splice(mIndex + 1, 0, novaMateria);

            // Re-renderiza a interface para mostrar a nova mat√©ria
            render();
            // Salva o estado atualizado no localStorage
            save();
        };
        // Adiciona o novo bot√£o ao div da mat√©ria atual
        materiaDiv.appendChild(addMateriaAbaixoBtn);
        // === FIM DO C√ìDIGO PARA ADICIONAR ===


			

        
        		app.appendChild(materiaDiv);
        
        
        
        		
        		
        		if(materia.aulas.length > 0){
        		const progress = materia.aulas.reduce((total, aula) => total + (statusWeights[aula.status] || 0), 0) / materia.aulas.length;
        		
        		const initialCount = materia.aulas.filter(aula => aula.status === 'inicial').length;
        		const nonInitialCount = materia.aulas.length - initialCount;
        		
        		const progressDiv = document.createElement('div');
        		progressDiv.textContent = `${progress.toFixed(0)}% de progresso na mat√©ria. Aulas iniciadas: ${materia.aulas.length-initialCount}/${materia.aulas.length}(${(((materia.aulas.length-initialCount)/materia.aulas.length)*100).toFixed(0)}%)`;
        		progressDiv.classList.add("progressMateriaTexto");
        		materiaDiv.appendChild(progressDiv);
        		
        		const progressProgress = document.createElement('progress');
        		progressProgress.min = 0;
        		progressProgress.max = 100;
        		progressProgress.value = progress.toFixed(0);
        		progressProgress.classList.add("progressMateria");
        		materiaDiv.appendChild(progressProgress);
        		}
        
        		/// < materia
        		
        	});
        
        	
        if(selectedRadio){document.getElementById("m"+selectedRadio).checked = true;}
        
		


		
	let totalProgress = 0;
        let totalAulas = 0;
        let totalInitialCount = 0;

		
        materias.forEach(materia => {
            totalAulas += materia.aulas.length;
            totalProgress += materia.aulas.reduce((total, aula) => total + (statusWeights[aula.status] || 0), 0);
            totalInitialCount += materia.aulas.filter(aula => aula.status === 'inicial').length;
        });
        
		
	if(totalAulas > 0) {
        
		const overallProgress = totalProgress / totalAulas;
        
        	const overallProgressDiv = document.getElementById('progressoTotalTexto');
        	overallProgressDiv.textContent = `Progresso Total: ${overallProgress.toFixed(0)}% - iniciadas: ${totalAulas-totalInitialCount} de ${totalAulas} (${(((totalAulas-totalInitialCount)/totalAulas)*100).toFixed(0)}%)`;
        	const overallProgressBarra = document.getElementById('progressoTotalBarra');
        	overallProgressBarra.value = overallProgress.toFixed(0);
	

            renderStreak();
	}
		
	// << render()	
        }
        
        function updateStatus(mIndex, aIndex) {
        	const aula = materias[mIndex].aulas[aIndex];
        	const lastStudyDate = new Date(aula.estudos.at(-1));
        	const currentDate = new Date();
        	const daysDiff = Math.floor((currentDate - lastStudyDate) / (1000 * 60 * 60 * 24))-1;
        	
        	aula.daysDiff = daysDiff;
        	
        	//alert(daysDiff)
        	switch (aula.status) {
        		case 'questoes1':
        			(daysDiff > 3)? aula.alerta = true : aula.alerta = false;
        			
        			break;
        		case 'questoes2':
        			(daysDiff > 7)? aula.alerta = true : aula.alerta = false;
        			//alert(daysDiff)
        			break;
        		case 'questoes3':
        
        		case 'revisao':
        			(daysDiff > 15)? aula.alerta = true: aula.alerta = false;
        			break;
        		default:
        			aula.alerta = false;
        			break;
        	}
        	if (daysDiff < 3) {
        		aula.alerta = false;
        		//console.log(aula);
        	}
        	if (isNaN(daysDiff) && aula.status !== "estudando" && aula.status !== "inicial") {
        		aula.alerta = true;
        	}
        	
        }
        
        function save() {
        	localStorage.setItem('materias', JSON.stringify(materias));
        	const selectedRadio = document.querySelector('input[name="onde"]:checked');
        	if (selectedRadio) {
        		localStorage.setItem('selectedRadio', selectedRadio.value);
        	}
        }
        function logAction(t){
            var date = new Date();
            var seconds = String(date.getSeconds()).padStart(2, '0');
            var minutes = String(date.getMinutes()).padStart(2, '0');
            var hours = String(date.getHours()).padStart(2, '0');
           document.getElementById('log').value += `${hours}:${minutes}:${seconds} > ${t}\n`;
        }
        
        function copyToJson() {
        	//document.getElementById('jsonArea').value = JSON.stringify(materias, null, 2);
        
            const replacer = (key, value) => {
                if (key === 'alerta' || key === 'daysDiff') return undefined;
                return value;
            };
            const dataStr = JSON.stringify(materias, replacer);
            document.getElementById('jsonArea').value = dataStr;
        }
        	    
        function exportToFile() {
            const dataStr = JSON.stringify(materias);
            const dataUri = 'data:text/plain;charset=utf-8,' + encodeURIComponent(dataStr);
            const exportFileDefaultName = 'estudos.txt';
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        function loadFromJson() {
        	try {
        		const json = JSON.parse(document.getElementById('jsonArea').value);
        		document.querySelectorAll('input[type="radio"]').forEach(radio => {
        			radio.checked = false;
        		});
        		materias.length = 0;
        		Array.prototype.push.apply(materias, json);
        		save();
        		render();
        	} catch (e) {
        		//alert('erro'+e);
        		console.log("Erro ao importar:")
        		console.log(e);
        	}
        }


	    function generateReport() {
    let reportText = "";

    materias.forEach(materia => {
        const totalAulas = materia.aulas.length;
        const aulasEstudadas = materia.aulas.filter(aula => aula.status !== 'inicial').length;

        reportText += ` Mat√©ria ${materia.nome} - Total de aulas: ${totalAulas}. Aulas j√° iniciadas ${aulasEstudadas}, sendo que: `;

        let aulaDescriptions = [];
        materia.aulas.forEach((aula, index) => {
            if (aula.status !== 'inicialx') {  // S√≥ inclui aulas que j√° foram iniciadas
                let aulaText = `Aula n√∫mero ${aula.nome} `;

                if (aula.alerta) {
                    aulaText += "precisa de revis√£o em algum momento futuro e ";
                } else {
                    aulaText += "n√£o precisa de revis√£o ";
                }

                if(!isNaN(aula.daysDiff)){
                     aulaText +=  `n√£o √© estudada h√° ${aula.daysDiff} dias `;
                }
                else{
                     aulaText +=  `, ainda n√£o foi iniciada `;
                }

              
                if (aula.status.startsWith('questoes')) {
                    aulaText += "foi estudada mas ainda tem quest√µes a resolver";
			if (aula.status.endsWith('1')) {
                    aulaText += ", 1/4 das quest√µes j√° foram resolvidas";
			}
			if (aula.status.endsWith('2')) {
                    aulaText += ", 2/4 das quest√µes j√° foram resolvidas";
			}
			if (aula.status.endsWith('3')) {
                    aulaText += ", 3/4 das quest√µes j√° foram resolvidas";
			}
			if(!isNaN(aula.daysDiff)){
                        aulaText += `, com o √∫ltima resolu√ß√£o h√° ${aula.daysDiff} dias`;
                     }
                } else if (aula.status === 'revisao') {
                    aulaText += "foi estudada, todas as quest√µes resolvidas e est√° no modo revis√£o, sendo necess√°ria uma revis√£o aleatoriamente periodicamente";
                } else if (aula.status === 'estudando') {
                    aulaText += "est√° em modo de estudo, ou seja, est√° sendo lida a parte do conte√∫do";
                     if(!isNaN(aula.daysDiff)){
                        aulaText += `, com o √∫ltimo estudo h√° ${aula.daysDiff} dias`;
                     }
                }
		    aulaText += '\n';

                aulaDescriptions.push(aulaText);
            }
        });


        reportText += aulaDescriptions.join(", ") + ".\n";
    });


    document.getElementById('reportArea').textContent = reportText;
}



function findAulasForReview() {
    // 1. Filtra TODAS as aulas que precisam de revis√£o (alerta = true)
    const aulasEmAlerta = materias.flatMap(materia =>
        materia.aulas
            .filter(aula => aula.alerta)
            .map(aula => ({
                mIndex: materias.indexOf(materia),
                aIndex: materia.aulas.indexOf(aula),
                materiaNome: materia.nome,
                aulaNome: aula.nome,
                status: aula.status,
                daysDiff: !isNaN(aula.daysDiff) ? aula.daysDiff : 0 // Trata NaN
            }))
    );

    // 2. Usa um Map para rastrear a aula com maior daysDiff por mat√©ria.
    const aulasPorMateria = new Map();

    for (const aula of aulasEmAlerta) {
        if (!aulasPorMateria.has(aula.mIndex) || aula.daysDiff > aulasPorMateria.get(aula.mIndex).daysDiff) {
            aulasPorMateria.set(aula.mIndex, aula);
        }
    }

    // 3. Converte o Map de volta para um array.
    return Array.from(aulasPorMateria.values());
}

	            const aulasForReview = findAulasForReview();
        function updateReviewSection() {
    const aulasForReview = findAulasForReview();
    const reviewSection = document.getElementById('reviewSection'); // Obt√©m o elemento existente

    if (aulasForReview.length > 0) {
        let randomAulaIndex = Math.floor(Math.random() * aulasForReview.length);
        let aulaToReview = aulasForReview[randomAulaIndex];

        let textoStatus = "";
        switch (aulaToReview.status) {
            case "inicial":
                textoStatus = "¬†";
                break;
            case "estudando":
                textoStatus = "estudando";
                break;
            case "questoes1":
                textoStatus = "1/4";
                break;
            case "questoes2":
                textoStatus = "2/4";
                break;
            case "questoes3":
                textoStatus = "3/4";
                break;
            case "revisao":
                textoStatus = "revisando";
                break;
            default:
                break;
        }

        // Atualiza o *conte√∫do interno* de reviewSection
        reviewSection.innerHTML = `
            <b>Quest√µes para revisar agora:</b>
            <br>${aulaToReview.materiaNome}
            <br>aula: <b>${aulaToReview.aulaNome}</b> (${textoStatus})
            <br>
            <button style="margin:auto" id="nextReviewButton" class="button" onClick="updateReviewSection()">pr√≥ximo desafio</button> 
	    <br><br>
        `;

    } else {
        reviewSection.innerHTML = `<b>Nenhuma aula para revisar no momento! üéâ</b>`;
    }
}


	    
	    
        
        
        	    
        render();
        updateReviewSection();
        
        
        	    
        let totalProgress = 0;
        let totalAulas = 0;
        let totalInitialCount = 0;
        
        materias.forEach(materia => {
            totalAulas += materia.aulas.length;
            totalProgress += materia.aulas.reduce((total, aula) => total + (statusWeights[aula.status] || 0), 0);
            totalInitialCount += materia.aulas.filter(aula => aula.status === 'inicial').length;
        });
        
        const overallProgress = totalProgress / totalAulas;
        
        const overallProgressDiv = document.getElementById('progressoTotalTexto');
        overallProgressDiv.textContent = `Progresso Total: ${overallProgress.toFixed(0)}% - N√£o estudadas: ${totalInitialCount} de ${totalAulas} (${((totalInitialCount/totalAulas)*100).toFixed(0)}%)`;
        const overallProgressBarra = document.getElementById('progressoTotalBarra');
        	    overallProgressBarra.value = overallProgress.toFixed(0);
        
        	    
        	    
        document.querySelectorAll('input[type="radio"][name="onde"]').forEach(radio => {
            radio.addEventListener('change', save);
        });
        
        
        
        
        
        
        
        
        
        
        // Fun√ß√£o para calcular streaks
function calculateCurrentStreak(dates) {
    const uniqueDates = [...new Set(dates)];
    uniqueDates.sort((a, b) => new Date(a) - new Date(b));
    const debug = document.getElementById('jsonArea'); //para debug
    //debug.value = uniqueDates;
    const currentDate = new Date();
    let currentStreak = 0;

    for (let i = 0; i < uniqueDates.length+2; i++) {
        const checkDate = new Date();
        checkDate.setDate(currentDate.getDate() - i);
	const dateStr = formatDate(checkDate);
        //debug.value += "\n >>> i=" + i + " dateStr=" + dateStr + " includes?" + uniqueDates.includes(dateStr);
        if (uniqueDates.includes(dateStr)) {
            currentStreak++;
        } else if (i > 1) {
            break;
        }
    }
    
    return currentStreak;
}
	    
        function calculateStreak(dates) {
            const streakDays = [0, 0, 0, 0, 0, 0, 0];
            const streakEmojis = 
		    ["Vamos l√°! Foco!",
		     "J√° √© o come√ßo! üéâ", 
		     "Plantando uma sementinha üå∞", 
		     "A sementinha est√° crescendo üå±", 
		     "Crescendo e se desenvolvendo üåø", 
		     "Forte e com sorte! üçÄ", 
		     "Frutificando sucesso üçì", 
		     "Brilhando como a flor de l√≥tus ü™∑",
		     "Doce recompensa üç™", 
		     "Acredite no seu potencial üåü",
		     "Voc√™ √© capaz de tudo! üöÄ",
		     "Cultive o h√°bito do sucesso üå±",
		     "Todo dia √© uma nova chance üåà",
		     "Cada passo conta üìö",
		     "Criando ra√≠zes üß†", 
		     "Sempre florescendo üéÑ",
		     "Seja o seu melhor ‚ú®",
		     "Cres√ßa a cada dia üåª",
		     "Atingindo novas alturas üå≤",
		     "Curiosidade √© a ess√™ncia üîç",
		     "Transforme o mundo com conhecimento üåç",
		     "Rumo √† vit√≥ria! üèÜ",
		     "Conhecimento √© poder üìö",
		     "Busque conhecimento üõ∏",
		     "O conhecimento √© a chave para abrir portas üîë",
		     "Sua dedica√ß√£o hoje molda seu amanh√£ üèÜ",
		     "Erros s√£o degraus para o sucesso ü™ú",
		     "Persist√™ncia supera talento üèãÔ∏è‚Äç‚ôÄÔ∏è",
		     "Conhecimento √© o investimento com maior retorno üìà",
		     "Sua curiosidade √© seu superpoder ü¶∏‚Äç‚ôÄÔ∏è",
		     "Pequenos progressos di√°rios levam a grandes conquistas üê¢",
		     "Seu esfor√ßo de hoje √© seu orgulho de amanh√£ üåü",
		     "Cada p√°gina virada √© uma vit√≥ria üìö",
		     "Aprenda algo novo todos os dias üÜï",
		     "O sucesso √© a soma de pequenos esfor√ßos üßÆ",
		     "Transforme desafios em oportunidades üîÑ",
		     "Seja a sua melhor vers√£o ü¶ã",
		     "Cada conceito dominado √© uma vit√≥ria üèÜ",
		     "A persist√™ncia leva √† excel√™ncia üåü",
		     "Seu esfor√ßo define seu sucesso üíØ",
		     "O conhecimento √© a luz na escurid√£o üí°",
		     "Grandes realiza√ß√µes exigem tempo ‚è≥",
		     "A educa√ß√£o √© o passaporte para o futuro üõÇ",
		     "Sua dedica√ß√£o de hoje √© seu sucesso de amanh√£ üåà"
		    ];
            const currentDate = new Date();
            let currentStreak = 0;
            let maxStreak = 0;
            let streakEmoji = streakEmojis[0];
	    let todayStreak = false;
	    let yesterdayStreak = false;
		
            for (let i = 6; i >= 0; i--) {
                const checkDate = new Date();
                checkDate.setDate(currentDate.getDate() - i);
                const dateStr = formatDate(checkDate);
                const count = dates.filter(date => date === dateStr).length;
                streakDays[6 - i] = count;

		// hoje
		if (i == 0 && count > 0) {
		    todayStreak = true;
		}
		// ontem
		if (i == 1 && count > 0) {
		    yesterdayStreak = true;
		}

		    
                /*
		if (count > 0) {
                    currentStreak++;
		} else {
		    if(i == 0){
			   // n√£o resetar o currentStreak 
		    }
		    else{
                        maxStreak = Math.max(maxStreak, currentStreak);
                        currentStreak = 0;
		    }
                }
		*/
		
		    
            }

	    currentStreak = calculateCurrentStreak(dates);
	    maxStreak = currentStreak;
            //maxStreak = Math.max(maxStreak, currentStreak);
            streakEmoji = streakEmojis[Math.min(currentStreak, streakEmojis.length - 1)];

            return { streakDays, maxStreak, streakEmoji, currentStreak, todayStreak, yesterdayStreak };
        }

        function renderStreak() {
            // Colete todas as datas de estudo de todas as mat√©rias e aulas
            const allDates = materias.flatMap(materia => materia.aulas.flatMap(aula => aula.estudos));
            console.log(allDates);
            const { streakDays, maxStreak, streakEmoji, currentStreak, todayStreak, yesterdayStreak } = calculateStreak(allDates);

            // Visualiza√ß√£o de streak dos √∫ltimos 7 dias
            const streakDiv = document.getElementById('streakDays');
            streakDiv.textContent = '';

            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];
            const currentDate = new Date();

            streakDays.forEach((count, index) => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'streakDia';

                const maxCount = Math.max(...streakDays);
                const minSaturation = 70;
                const maxSaturation = 100;
                const saturation = count > 0 ? minSaturation + (count - 1) * (maxSaturation - minSaturation) / maxCount : 0;
                dayDiv.style.backgroundColor = count > 0 ? `hsl(81.51deg ${saturation}% 39.8%)` : '#464646';


                const dayNameDiv = document.createElement('div');
                const dayIndex = (currentDate.getDay() - 6 + index + 7) % 7; // Calcular o √≠ndice do dia da semana
                dayNameDiv.textContent = dayNames[dayIndex];
                dayNameDiv.className = 'dayName';

                dayDiv.appendChild(dayNameDiv);

                const dayCount = document.createElement('div');
                dayCount.textContent = count;
                dayCount.className = 'dayCount';
                dayDiv.appendChild(dayCount);

                streakDiv.appendChild(dayDiv);
            });

            // Visualiza√ß√£o de contagem de dias seguidos
            const streakCountDiv = document.getElementById('streakInfo');
		if(yesterdayStreak == false && todayStreak == false){
			streakCountDiv.innerHTML = `For√ßa e foco! Voc√™ vai conseguir! Comece aos poucos, mas com regularidade!`;
		} else if(yesterdayStreak == true && todayStreak == false){
			streakCountDiv.innerHTML = `${streakEmoji}<br>${currentStreak}${currentStreak == 1? ".¬∫ dia de muitos mais!": " dias seguidos!"}<br>Marque o estudo hoje para manter a contagem! Foco!`;
		} else {
            		streakCountDiv.innerHTML = `${streakEmoji}<br>${currentStreak}${currentStreak == 1? ".¬∫ dia de muitos mais!": " dias seguidos!"}`;
		}
        }
        
        























let currentPopover = null;  // Vari√°vel global para armazenar o popover atual

function openAulaConfigPopover(aula, materia) {
    // Fecha o popover atual, se houver
    if (currentPopover) {
        closePopover(currentPopover);
    }

    // Criar o popover
    const popover = document.createElement('div');
    popover.className = 'popover';

    // Atualiza o popover atual
    currentPopover = popover;

    // T√≠tulo para edi√ß√£o do nome da aula
    const nameLabel = document.createElement('label');
    nameLabel.classList.add("popover-nameLabel");
    nameLabel.textContent = 'Nome da aula:';
    const nameInput = document.createElement('input');
    nameInput.type = 'text';
    nameInput.value = aula.nome;
    let nomeAntigo = aula.nome;

    // Bot√£o para salvar o nome da aula editado
    const saveNameButton = document.createElement('button');
    saveNameButton.classList.add("popover-saveName");
    saveNameButton.textContent = 'Salvar Nome';
    saveNameButton.onclick = function () {
        if(isNaN(nameInput.value)){
            aula.nome = nameInput.value;
        } else {
            aula.nome = Number(nameInput.value); 
        }
        logAction(`(${aula.nome}) Nome mudado de ${nomeAntigo} [${materia.nome}]`);
        save();  // Salva os dados atualizados
        render(); // Renderiza a interface novamente
        //closePopover(popover);
    };

    // Visualiza√ß√£o dos dias estudados (array estudos)
    const daysLabel = document.createElement('label');
    daysLabel.textContent = 'Dias estudados:';
    daysLabel.classList.add("popover-daysLabel");

    const daysList = document.createElement('ul');
    daysList.classList.add("popover-dayslist");
    aula.estudos.forEach((date, index) => {
        const dayItem = document.createElement('li');
        dayItem.textContent = date;

        const deleteDayButton = document.createElement('button');
        deleteDayButton.textContent = 'Deletar';
        deleteDayButton.onclick = function () {
            logAction(`(${aula.nome}) Removendo dia de estudo ${aula.estudos[index]} [${materia.nome}]`);
            aula.estudos.splice(index, 1); // Remove a data do array
            save();  // Salva os dados atualizados
            render(); // Renderiza a interface novamente
            deleteDayButton.setAttribute('disabled', true); // Remove o item da lista
            openAulaConfigPopover(aula, materia);
        };

	    dayItem.onclick = function() {
		editDate(aula, index, materia, popover); //chama a fun√ß√£o de edi√ß√£o. Adicione popover.
	};

        dayItem.appendChild(deleteDayButton);
        daysList.appendChild(dayItem);
    });
    if(aula.estudos.length == 0){
        const semItens = document.createElement('li');
        semItens.textContent = 'Sem dias contabilizados.';
        daysList.appendChild(semItens);
    }

    // Bot√£o para deletar a aula com confirma√ß√£o
    const deleteAulaButton = document.createElement('button');
    deleteAulaButton.classList.add("popover-delete");
    deleteAulaButton.textContent = 'Deletar Aula';
    deleteAulaButton.onclick = function () {
        if (confirm('Tem certeza em deletar esta aula? N√£o √© revers√≠vel.')) {
            const aulaIndex = materia.aulas.indexOf(aula);
            if (aulaIndex > -1) {
                logAction(`(${aula.nome}) Aula DELETADA [${aulaIndex}] [${materia.nome}]`);
                materia.aulas.splice(aulaIndex, 1); // Remove a aula do array
                save();  // Salva os dados atualizados
                render(); // Renderiza a interface novamente
                closePopover(popover);
            }
        }
    };

    function editDate(aula, index, materia, popover) { //recebe popover como parametro
	const oldDate = aula.estudos[index];
	const newDate = prompt("Edite a data (AAAA-MM-DD):", oldDate);

	if (newDate !== null && newDate !== "" && isValidDate(newDate)) {
		aula.estudos[index] = newDate;
        logAction(`(${aula.nome}) Dia editado de ${oldDate} para ${newDate} [${materia.nome}]`);
		save();
		render();
		//reabrir o popover
		openAulaConfigPopover(aula, materia);
		
	} else if (newDate !== null) {
		alert("Formato de data inv√°lido. Use AAAA-MM-DD.");
		editDate(aula, index, materia, popover); // Mant√©m no popover
	} else {
		//reabrir o popover, se cancelado
		openAulaConfigPopover(aula, materia);
	}
}

	function isValidDate(dateString) {
  return /^\d{4}-\d{2}-\d{2}$/.test(dateString);
}



	
    const closeButton = document.createElement('button');
    closeButton.classList.add("popover-close");
    closeButton.textContent = 'X';
    closeButton.onclick = function () {
        closePopover(popover)
    };

    // Adicionar todos os elementos ao popover
    popover.appendChild(nameLabel);
    popover.appendChild(nameInput);
    popover.appendChild(saveNameButton);
    popover.appendChild(daysLabel);
    popover.appendChild(daysList);
    popover.appendChild(deleteAulaButton);
    popover.appendChild(closeButton);

    // Mostrar o popover
    document.body.appendChild(popover);
}

function closePopover(popover) {
    if (popover) {
        popover.remove();
        currentPopover = null; // Reseta o popover atual
    }
}

	    


	    
        
    </script>
</body>

</html>
